<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFSTAMP — Certifying Destiny, One Document at a Time</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0a84ff;
            --primary-dark: #0066cc;
            --success: #34c759;
            --success-dark: #248a3d;
            --bg-dark: #0a0a0a;
            --bg-darker: #050505;
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, var(--bg-darker) 0%, #1a1a2e 50%, #16213e 100%);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(10, 132, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(52, 199, 89, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* Header/Hero Section */
        .hero {
            position: relative;
            text-align: center;
            padding: 80px 20px 60px;
            background: linear-gradient(180deg, rgba(10, 132, 255, 0.1) 0%, transparent 100%);
            border-bottom: 1px solid var(--glass-border);
            z-index: 1;
        }

        .logo-container {
            margin-bottom: 30px;
            animation: fadeInDown 1s ease-out;
        }

        .logo {
            font-size: 72px;
            font-weight: 900;
            letter-spacing: -2px;
            background: linear-gradient(135deg, #0a84ff 0%, #00d4ff 50%, #34c759 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 80px rgba(10, 132, 255, 0.5);
            position: relative;
            display: inline-block;
        }

        .logo::before {
            content: '📄';
            position: absolute;
            left: -90px;
            top: 50%;
            transform: translateY(-50%) rotate(-10deg);
            font-size: 60px;
            animation: float 3s ease-in-out infinite;
        }

        .tagline {
            font-size: 24px;
            color: var(--text-secondary);
            font-weight: 300;
            margin-bottom: 20px;
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        .hero-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
            animation: fadeInUp 1s ease-out 0.4s both;
        }

        /* Main Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 60px 20px;
            position: relative;
            z-index: 1;
        }

        .section-title {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--success));
            margin: 16px auto 0;
            border-radius: 2px;
        }

        .card {
            background: var(--glass-bg);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            padding: 40px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(10, 132, 255, 0.2);
        }

        .input-group {
            margin-bottom: 28px;
        }

        label {
            display: block;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .date-input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.2s;
        }

        .date-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.1);
        }

        .upload-area {
            width: 100%;
            padding: 60px 30px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px dashed var(--glass-border);
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(10, 132, 255, 0.1) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: all 0.5s;
        }

        .upload-area:hover::before {
            width: 300px;
            height: 300px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(10, 132, 255, 0.05);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 56px;
            margin-bottom: 16px;
            animation: bounce 2s ease-in-out infinite;
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 400;
        }

        #pdfInput {
            display: none;
        }

        .pdf-list {
            margin-top: 24px;
        }

        .pdf-item {
            display: flex;
            align-items: center;
            gap: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 18px 22px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .pdf-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(4px);
        }

        .pdf-icon {
            font-size: 28px;
        }

        .pdf-name {
            flex: 1;
            font-size: 15px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 500;
        }

        .code-input {
            width: 200px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 15px;
            transition: all 0.2s;
        }

        .code-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.1);
        }

        .btn {
            width: 100%;
            padding: 20px;
            font-size: 17px;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-start {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--text-primary);
        }

        .btn-start:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(10, 132, 255, 0.4);
        }

        .btn-start:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* Preview Section */
        .preview-section {
            display: none;
        }

        .preview-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .preview-header {
            margin-bottom: 24px;
            text-align: center;
        }

        .preview-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .preview-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .preview-canvas-container {
            background: #ffffff;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        #previewCanvas {
            display: block;
            cursor: move;
            max-width: 100%;
            height: auto;
        }

        .opacity-control {
            margin-bottom: 24px;
        }

        .opacity-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .slider {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(10, 132, 255, 0.5);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(10, 132, 255, 0.5);
        }

        .slider-value {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
        }

        .preview-actions {
            display: flex;
            gap: 16px;
        }

        .btn-next, .btn-generate {
            flex: 1;
            padding: 18px;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .btn-next {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(10, 132, 255, 0.4);
        }

        .btn-generate {
            background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 199, 89, 0.4);
        }

        /* About Section */
        .about-section {
            background: linear-gradient(180deg, transparent 0%, rgba(10, 132, 255, 0.05) 100%);
            padding: 100px 20px;
            margin-top: 100px;
            border-top: 1px solid var(--glass-border);
            position: relative;
            z-index: 1;
        }

        .about-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .about-title {
            font-size: 48px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 60px;
            background: linear-gradient(135deg, #fff 0%, #0a84ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .about-block {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 50px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
        }

        .about-block h3 {
            font-size: 32px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .about-block h3::before {
            font-size: 40px;
        }

        .about-block p {
            font-size: 18px;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 16px;
        }

        .about-block strong {
            color: var(--primary);
            font-weight: 600;
        }

        .highlight {
            background: linear-gradient(135deg, rgba(10, 132, 255, 0.2), rgba(52, 199, 89, 0.2));
            padding: 30px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            margin: 30px 0;
        }

        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .tech-item {
            background: rgba(10, 132, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }

        /* Footer */
        .footer {
            background: var(--bg-darker);
            border-top: 1px solid var(--glass-border);
            padding: 60px 20px 40px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .footer-logo {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .footer-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .footer-legal {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid var(--glass-border);
        }

        .status {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            color: var(--text-primary);
            padding: 18px 36px;
            border-radius: 12px;
            font-size: 15px;
            border: 1px solid var(--glass-border);
            display: none;
            z-index: 1001;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        }

        .status.show {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(-50%) rotate(-10deg); }
            50% { transform: translateY(-60%) rotate(-10deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 48px;
            }

            .logo::before {
                left: -70px;
                font-size: 40px;
            }

            .tagline {
                font-size: 20px;
            }

            .section-title {
                font-size: 28px;
            }

            .card {
                padding: 30px 20px;
            }

            .pdf-item {
                flex-direction: column;
                align-items: stretch;
            }

            .code-input {
                width: 100%;
            }

            .preview-actions {
                flex-direction: column;
            }

            .about-block {
                padding: 30px 20px;
            }

            .about-block h3 {
                font-size: 24px;
            }

            .about-block p {
                font-size: 16px;
            }

            .about-title {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero">
        <div class="logo-container">
            <div class="logo">PDFSTAMP</div>
        </div>
        <p class="tagline">Certifying Destiny, One Document at a Time</p>
        <p class="hero-subtitle">The world's most advanced, AI-enhanced, family-owned PDF stamping technology</p>
    </div>

    <!-- Main Application -->
    <div class="container">
        <h2 class="section-title">Stamp Your Documents</h2>

        <div class="card">
            <div class="input-group">
                <label for="dateInput">Select Date</label>
                <input type="date" id="dateInput" class="date-input">
            </div>

            <div class="input-group">
                <label>Upload PDF Files</label>
                <div class="upload-area" onclick="document.getElementById('pdfInput').click()">
                    <div class="upload-icon">📄</div>
                    <div class="upload-text">Click to select PDF files or drag & drop</div>
                </div>
                <input type="file" id="pdfInput" accept=".pdf" multiple>
            </div>

            <div id="pdfList" class="pdf-list"></div>
        </div>

        <button id="startBtn" class="btn btn-start" disabled>Start Positioning Stamps</button>

        <!-- Preview Section -->
        <div id="previewSection" class="card preview-section">
            <div class="preview-header">
                <div class="preview-title" id="previewTitle">Position Stamp</div>
                <div class="preview-subtitle">Drag the stamp to position it perfectly</div>
            </div>

            <div class="preview-canvas-container">
                <canvas id="previewCanvas"></canvas>
            </div>

            <div class="opacity-control">
                <label class="opacity-label">
                    <span>Stamp Opacity</span>
                    <span class="slider-value" id="opacityValue">50%</span>
                </label>
                <input type="range" id="opacitySlider" class="slider" min="10" max="100" value="50">
            </div>

            <div class="preview-actions">
                <button class="btn-next" id="nextBtn">Next PDF →</button>
                <button class="btn-generate" id="generateBtn" style="display: none;">✓ Generate Combined PDF</button>
            </div>
        </div>
    </div>

    <!-- About Section -->
    <div class="about-section">
        <div class="about-container">
            <h2 class="about-title">The PDFSTAMP Story</h2>

            <div class="about-block">
                <h3>🧭 Our Mission</h3>
                <p>At <strong>PDFSTAMP</strong>, we don't just stamp PDFs — we stamp history.</p>
                <p>Born from a single-page app and a dream, PDFSTAMP exists to bridge the gap between human authenticity and digital permanence. In an age where trust is tokenized, and AI rewrites reality, our stamps stand as the immutable proof of presence — a cryptographic handshake between the physical and digital world.</p>
                <div class="highlight">
                    <p><strong>We believe every PDF deserves its moment of truth.</strong></p>
                    <p>That's why we built the world's most hyperlocal, family-owned, AI-enhanced, blockchain-optional stamping technology.</p>
                </div>
                <p>We're not in the business of marking documents. <strong>We're in the business of certifying destiny.</strong></p>
            </div>

            <div class="about-block">
                <h3>🏗️ Our Origin Story</h3>
                <p>It started, like all great revolutions, in a half-furnished office with flickering fluorescent lights, two ergonomic chairs, and a dream.</p>
                <p>Two visionaries sat side-by-side — one holding a phone, the other a printed PDF — and asked the question that would redefine the digital landscape forever:</p>
                <div class="highlight">
                    <p><em>"What if… we stamped PDFs… but, like, really well?"</em></p>
                </div>
                <p>From that moment, the seed of PDFSTAMP was planted. What began as a side project coded in an hour became a movement — a <strong>generational family business</strong> powered by love, espresso, and CSS flexbox.</p>
                <p>Today, PDFSTAMP operates at the intersection of AI, trust, and vibes.</p>
                <p>We're proud to remain <strong>100% independently funded</strong> — no VC, no ICO, just pure belief and a Venmo subscription.</p>
            </div>

            <div class="about-block">
                <h3>🤖 The Technology</h3>
                <p>Under the hood, PDFSTAMP is powered by:</p>
                <div class="tech-grid">
                    <div class="tech-item">
                        <strong>Neural Seal™</strong><br>
                        <small>(patent pending… probably)</small>
                    </div>
                    <div class="tech-item">
                        <strong>Localhost Consensus</strong><br>
                        <small>Cutting-edge</small>
                    </div>
                    <div class="tech-item">
                        <strong>Proof-of-Document</strong><br>
                        <small>PoD Protocol</small>
                    </div>
                    <div class="tech-item">
                        <strong>Family Values</strong><br>
                        <small>Core technology</small>
                    </div>
                </div>
                <p>Every stamp is a micro-moment of innovation — combining cutting-edge automation with hand-crafted precision passed down through generations of document artisans.</p>
                <div class="highlight">
                    <p><strong>We don't just use JavaScript. We infuse intention into every async call.</strong></p>
                </div>
            </div>

            <div class="about-block">
                <h3>💡 Why It Matters</h3>
                <p>Because authenticity isn't dead — it's just been rebranded.</p>
                <p>In a world of AI-generated contracts and metaverse NDAs, you deserve to know what's real. PDFSTAMP gives you that certainty with a simple click — delivering tamper-proof verification, impeccable vibes, and a faint smell of fresh toner.</p>
                <p><strong>Each stamp is not just a mark; it's a movement.</strong><br>
                Each user isn't a client; they're a co-creator in the trust economy.</p>
            </div>

            <div class="about-block">
                <h3>🌍 The Vision</h3>
                <p>By 2030, PDFSTAMP aims to <strong>stamp every PDF on the planet</strong>.</p>
                <p>From international treaties to PTA permission slips, from corporate mergers to dog adoption forms — we envision a future where every document is sealed with love, lineage, and latent AI potential.</p>
                <div class="highlight">
                    <p><strong>We're building the future of proof — one over-engineered API call at a time.</strong></p>
                </div>
            </div>

            <div class="about-block">
                <h3>🕯️ Our Promise</h3>
                <p><strong>We will never sell your data.</strong><br>
                <strong>We will never pivot to NFTs.</strong><br>
                <strong>We will never forget where we came from</strong> — that cramped office with two guys, two chairs, and one dream:</p>
                <div class="highlight">
                    <p><em>To stamp PDFs beautifully.</em></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            <div class="footer-logo">PDFSTAMP</div>
            <p class="footer-text">
                Built with love, intention, and an unhealthy amount of attention to detail.<br>
                Stamping documents since [REDACTED]. Changing lives since always.
            </p>
            <p class="footer-text">
                For support, inquiries, or existential questions about document authenticity,<br>
                reach out to us in the multiverse.
            </p>
            <div class="footer-legal">
                <p>© 2025 PDFSTAMP™. All rights reserved. Patents pending. Vibes certified.</p>
                <p>Terms of Service | Privacy Policy | Proof-of-Document Protocol | Family Values Charter</p>
                <p>No PDFs were harmed in the making of this application.</p>
                <p>This is a family business. Please respect the craft.</p>
            </div>
        </div>
    </div>

    <div id="status" class="status"></div>

    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        document.getElementById('dateInput').value = new Date().toISOString().split('T')[0];

        let stampImage = null;
        let pdfFiles = [];
        let currentPdfIndex = 0;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };
        let canvasScale = 1;

        async function loadStampImage() {
            try {
                showStatus('Loading stamp image...');
                const response = await fetch('stamp pci.jpg');
                if (!response.ok) throw new Error('Could not load stamp pci.jpg');
                
                const blob = await response.blob();
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        stampImage = img;
                        showStatus('✓ Ready! Stamp image loaded.');
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(blob);
                
            } catch (error) {
                showStatus('ERROR: Could not load stamp pci.jpg');
                console.error(error);
            }
        }

        loadStampImage();

        document.getElementById('pdfInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            pdfFiles = files.map(file => ({ 
                file: file, 
                code: '',
                stampX: null,
                stampY: null,
                opacity: 0.5
            }));
            renderPdfList();
            showStatus(`${files.length} PDF file(s) loaded`);
        });

        function renderPdfList() {
            const listEl = document.getElementById('pdfList');
            listEl.innerHTML = '';

            if (pdfFiles.length === 0) return;

            pdfFiles.forEach((pdfData) => {
                const item = document.createElement('div');
                item.className = 'pdf-item';
                
                const icon = document.createElement('span');
                icon.className = 'pdf-icon';
                icon.textContent = '📄';
                
                const name = document.createElement('span');
                name.className = 'pdf-name';
                name.textContent = pdfData.file.name;
                name.title = pdfData.file.name;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'code-input';
                input.placeholder = 'Enter code';
                input.value = pdfData.code;
                input.addEventListener('input', function(e) {
                    pdfData.code = e.target.value;
                    updateStartButton();
                });
                
                item.appendChild(icon);
                item.appendChild(name);
                item.appendChild(input);
                listEl.appendChild(item);
            });

            updateStartButton();
        }

        function updateStartButton() {
            const hasStamp = stampImage !== null;
            const hasPdfs = pdfFiles.length > 0;
            const allHaveCodes = pdfFiles.every(pdf => pdf.code.trim() !== '');
            document.getElementById('startBtn').disabled = !(hasStamp && hasPdfs && allHaveCodes);
        }

        document.getElementById('startBtn').addEventListener('click', async function() {
            currentPdfIndex = 0;
            document.getElementById('previewSection').classList.add('active');
            document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
            await showPdfPreview(currentPdfIndex);
        });

        async function showPdfPreview(index) {
            const pdfData = pdfFiles[index];
            
            showStatus('Loading preview...');
            
            try {
                const arrayBuffer = await pdfData.file.arrayBuffer();
                const loadingTask = pdfjsLib.getDocument(arrayBuffer);
                const pdf = await loadingTask.promise;
                const page = await pdf.getPage(1);
                
                const canvas = document.getElementById('previewCanvas');
                const ctx = canvas.getContext('2d');
                
                const viewport = page.getViewport({ scale: 1 });
                canvasScale = 0.6;
                const scaledViewport = page.getViewport({ scale: canvasScale });
                
                canvas.width = scaledViewport.width;
                canvas.height = scaledViewport.height;
                
                await page.render({
                    canvasContext: ctx,
                    viewport: scaledViewport
                }).promise;
                
                if (pdfData.stampX === null) {
                    const stampWidth = 150 * canvasScale;
                    pdfData.stampX = canvas.width - stampWidth - (30 * canvasScale);
                    pdfData.stampY = 30 * canvasScale;
                }
                
                document.getElementById('opacitySlider').value = pdfData.opacity * 100;
                document.getElementById('opacityValue').textContent = Math.round(pdfData.opacity * 100) + '%';
                
                await drawStampOnCanvas();
                
                document.getElementById('previewTitle').textContent = `PDF ${index + 1} of ${pdfFiles.length}: ${pdfData.file.name}`;
                
                if (index === pdfFiles.length - 1) {
                    document.getElementById('nextBtn').style.display = 'none';
                    document.getElementById('generateBtn').style.display = 'block';
                } else {
                    document.getElementById('nextBtn').style.display = 'block';
                    document.getElementById('generateBtn').style.display = 'none';
                }
                
                showStatus('Drag stamp to position');
                
            } catch (error) {
                showStatus('Error loading preview: ' + error.message);
                console.error(error);
            }
        }

        async function drawStampOnCanvas() {
            const canvas = document.getElementById('previewCanvas');
            const ctx = canvas.getContext('2d');
            const pdfData = pdfFiles[currentPdfIndex];
            
            const arrayBuffer = await pdfData.file.arrayBuffer();
            const loadingTask = pdfjsLib.getDocument(arrayBuffer);
            const pdf = await loadingTask.promise;
            const page = await pdf.getPage(1);
            const scaledViewport = page.getViewport({ scale: canvasScale });
            
            await page.render({
                canvasContext: ctx,
                viewport: scaledViewport
            }).promise;
            
            const stampCanvas = document.createElement('canvas');
            const stampCtx = stampCanvas.getContext('2d');
            
            stampCanvas.width = stampImage.width;
            stampCanvas.height = stampImage.height;
            
            stampCtx.drawImage(stampImage, 0, 0);
            
            const dateText = formatDate(document.getElementById('dateInput').value);
            const codeText = pdfData.code;
            
            stampCtx.fillStyle = '#000000';
            stampCtx.textAlign = 'left';
            stampCtx.textBaseline = 'middle';
            
            const fontSize = Math.floor(stampCanvas.width / 12);
            stampCtx.font = `900 ${fontSize}px Arial Black, Arial`;
            
            const leftMargin = stampCanvas.width * 0.30;
            const dateY = stampCanvas.height * 0.62;
            const codeY = stampCanvas.height * 0.83;
            
            stampCtx.strokeStyle = '#000000';
            stampCtx.lineWidth = 2;
            
            stampCtx.strokeText(dateText, leftMargin, dateY);
            stampCtx.fillText(dateText, leftMargin, dateY);
            
            stampCtx.strokeText(codeText, leftMargin, codeY);
            stampCtx.fillText(codeText, leftMargin, codeY);
            
            ctx.globalAlpha = pdfData.opacity;
            
            const stampWidth = 150 * canvasScale;
            const stampHeight = 90 * canvasScale;
            
            ctx.drawImage(stampCanvas, pdfData.stampX, pdfData.stampY, stampWidth, stampHeight);
            ctx.globalAlpha = 1.0;
        }

        document.getElementById('opacitySlider').addEventListener('input', async function(e) {
            pdfFiles[currentPdfIndex].opacity = e.target.value / 100;
            document.getElementById('opacityValue').textContent = e.target.value + '%';
            await drawStampOnCanvas();
        });

        const canvas = document.getElementById('previewCanvas');
        
        canvas.addEventListener('mousedown', function(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const pdfData = pdfFiles[currentPdfIndex];
            
            const stampWidth = 150 * canvasScale;
            const stampHeight = 90 * canvasScale;
            
            if (x >= pdfData.stampX && x <= pdfData.stampX + stampWidth &&
                y >= pdfData.stampY && y <= pdfData.stampY + stampHeight) {
                isDragging = true;
                dragOffset.x = x - pdfData.stampX;
                dragOffset.y = y - pdfData.stampY;
            }
        });

        canvas.addEventListener('mousemove', async function(e) {
            if (!isDragging) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const pdfData = pdfFiles[currentPdfIndex];
            
            pdfData.stampX = x - dragOffset.x;
            pdfData.stampY = y - dragOffset.y;
            
            await drawStampOnCanvas();
        });

        canvas.addEventListener('mouseup', function() {
            isDragging = false;
        });

        canvas.addEventListener('mouseleave', function() {
            isDragging = false;
        });

        document.getElementById('nextBtn').addEventListener('click', async function() {
            currentPdfIndex++;
            await showPdfPreview(currentPdfIndex);
        });

        async function createStampedImage(dateText, codeText) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = stampImage.width;
            canvas.height = stampImage.height;
            
            ctx.drawImage(stampImage, 0, 0);
            
            ctx.fillStyle = '#000000';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'middle';
            
            const fontSize = Math.floor(canvas.width / 12);
            ctx.font = `900 ${fontSize}px Arial Black, Arial`;
            
            const leftMargin = canvas.width * 0.30;
            const dateY = canvas.height * 0.62;
            const codeY = canvas.height * 0.83;
            
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.strokeText(dateText, leftMargin, dateY);
            ctx.fillText(dateText, leftMargin, dateY);
            
            ctx.strokeText(codeText, leftMargin, codeY);
            ctx.fillText(codeText, leftMargin, codeY);
            
            return new Promise((resolve) => {
                canvas.toBlob(async (blob) => {
                    const arrayBuffer = await blob.arrayBuffer();
                    resolve(new Uint8Array(arrayBuffer));
                }, 'image/jpeg', 0.95);
            });
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const year = date.getFullYear();
            return `${month}/${day}/${year}`;
        }

        document.getElementById('generateBtn').addEventListener('click', async function() {
            showStatus('Generating PDF...');

            try {
                const { PDFDocument } = PDFLib;
                const mergedPdf = await PDFDocument.create();
                const dateStr = formatDate(document.getElementById('dateInput').value);

                for (let i = 0; i < pdfFiles.length; i++) {
                    const pdfData = pdfFiles[i];
                    
                    const stampedImageBytes = await createStampedImage(dateStr, pdfData.code);
                    
                    const arrayBuffer = await pdfData.file.arrayBuffer();
                    const sourcePdf = await PDFDocument.load(arrayBuffer);
                    
                    const pageIndices = sourcePdf.getPageIndices();
                    const copiedPages = await mergedPdf.copyPages(sourcePdf, pageIndices);
                    
                    for (let pageIndex = 0; pageIndex < copiedPages.length; pageIndex++) {
                        const page = copiedPages[pageIndex];
                        mergedPdf.addPage(page);
                        
                        if (pageIndex === 0) {
                            const stampImg = await mergedPdf.embedJpg(stampedImageBytes);
                            const { width, height } = page.getSize();
                            
                            const stampWidth = 150;
                            const stampHeight = 90;
                            
                            const x = pdfData.stampX / canvasScale;
                            const y = height - (pdfData.stampY / canvasScale) - stampHeight;
                            
                            page.drawImage(stampImg, {
                                x: x,
                                y: y,
                                width: stampWidth,
                                height: stampHeight,
                                opacity: pdfData.opacity
                            });
                        }
                    }
                }

                const pdfBytes = await mergedPdf.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `stamped_${Date.now()}.pdf`;
                a.click();
                
                URL.revokeObjectURL(url);
                showStatus('✓ PDF generated successfully!');

            } catch (error) {
                showStatus('Error: ' + error.message);
                console.error(error);
            }
        });

        function showStatus(message) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.classList.add('show');
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
